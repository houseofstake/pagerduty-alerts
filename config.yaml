# NEAR PagerDuty Alert Configuration
#
# This file configures which blockchain actions trigger PagerDuty alerts.
# Uses the neardata WebSocket stream (wss://actions.near.stream/ws).

# Your PagerDuty Events API v2 integration key
# Get this from: PagerDuty → Services → Your Service → Integrations → Events API V2
# You can either set it here OR use the PAGERDUTY_ROUTING_KEY environment variable
# (recommended: leave this commented/empty and use env var for security)
# pagerduty_routing_key: "YOUR_PAGERDUTY_ROUTING_KEY_HERE"

# Reconnection delay when WebSocket disconnects (seconds)
reconnect_delay_secs: 5

# Event subscriptions - each triggers PagerDuty alerts when matching actions occur
subscriptions:
  # ==========================================================================
  # veNEAR Contract Monitoring
  # Critical alerts for pause/unpause actions on the veNEAR contract
  # ==========================================================================

  - name: "veNEAR: Contract Paused"
    account_id: "venear.near"  # Change to your veNEAR contract
    method_name: "pause"
    severity: critical
    summary_template: "CRITICAL: veNEAR contract paused by {predecessor_id}"
    dedup_key_template: "venear-pause-{tx_hash}"

  - name: "veNEAR: Contract Unpaused"
    account_id: "venear.near"
    method_name: "unpause"
    severity: warning
    summary_template: "veNEAR contract unpaused by {predecessor_id}"
    dedup_key_template: "venear-unpause-{tx_hash}"

  # ==========================================================================
  # veNEAR Governance Changes (error level)
  # ==========================================================================

  - name: "veNEAR: Guardians Changed"
    account_id: "venear.near"
    method_name: "set_guardians"
    severity: error
    summary_template: "veNEAR guardians changed by {predecessor_id}"
    dedup_key_template: "venear-guardians-{tx_hash}"

  - name: "veNEAR: Ownership Transfer Proposed"
    account_id: "venear.near"
    method_name: "propose_new_owner_account_id"
    severity: error
    summary_template: "veNEAR ownership transfer proposed by {predecessor_id}"
    dedup_key_template: "venear-owner-propose-{tx_hash}"

  - name: "veNEAR: Ownership Transfer Accepted"
    account_id: "venear.near"
    method_name: "accept_ownership"
    severity: error
    summary_template: "veNEAR ownership transfer accepted by {predecessor_id}"
    dedup_key_template: "venear-owner-accept-{tx_hash}"

  - name: "veNEAR: Lockup Contract Updated"
    account_id: "venear.near"
    method_name: "set_lockup_contract"
    severity: error
    summary_template: "veNEAR lockup contract code updated by {predecessor_id}"
    dedup_key_template: "venear-lockup-contract-{tx_hash}"

  # ==========================================================================
  # veNEAR User Activity (info level)
  # ==========================================================================

  - name: "veNEAR: New Lockup Deployed"
    account_id: "venear.near"
    method_name: "deploy_lockup"
    severity: info
    summary_template: "New veNEAR lockup deployed by {predecessor_id}"
    dedup_key_template: "venear-lockup-{tx_hash}"

  - name: "veNEAR: Delegation"
    account_id: "venear.near"
    method_name: "delegate_all"
    severity: info
    summary_template: "veNEAR delegation by {predecessor_id}"
    dedup_key_template: "venear-delegate-{tx_hash}"

  - name: "veNEAR: Undelegation"
    account_id: "venear.near"
    method_name: "undelegate"
    severity: info
    summary_template: "veNEAR undelegation by {predecessor_id}"
    dedup_key_template: "venear-undelegate-{tx_hash}"

  # ==========================================================================
  # Example: Monitor all actions on a contract (no method filter)
  # ==========================================================================

  # - name: "All Contract Actions"
  #   account_id: "my-contract.near"
  #   # method_name: omitted = alert on ANY action
  #   severity: info
  #   summary_template: "Action on my-contract: {method_name} from {predecessor_id}"
  #   dedup_key_template: "my-contract-{tx_hash}"

  # ==========================================================================
  # Example: Monitor specific method calls
  # ==========================================================================

  # - name: "Token Transfers"
  #   account_id: "token.near"
  #   method_name: "ft_transfer"
  #   severity: info
  #   summary_template: "Token transfer on {account_id} from {signer_id}"
  #   dedup_key_template: "transfer-{tx_hash}"

  # - name: "Contract Upgrades"
  #   account_id: "my-contract.near"
  #   method_name: "upgrade"
  #   severity: critical
  #   summary_template: "CRITICAL: Contract upgrade on {account_id} by {predecessor_id}"
  #   dedup_key_template: "upgrade-{tx_hash}"

# =============================================================================
# Configuration Reference
# =============================================================================
#
# Subscription Fields:
#   name            : Human-readable name for this alert
#   account_id      : The NEAR contract to monitor (required)
#   method_name     : Filter for specific method calls (optional - omit to match all)
#   severity        : PagerDuty severity: critical, error, warning, info
#   summary_template: Alert message (supports placeholders)
#   dedup_key_template: Deduplication key (supports placeholders)
#
# Available Placeholders:
#   {account_id}     : The contract that received the action
#   {method_name}    : The method that was called (for FunctionCall actions)
#   {predecessor_id} : The immediate caller of the contract
#   {signer_id}      : The transaction signer
#   {tx_hash}        : Transaction hash
#   {receipt_id}     : Receipt ID
#   {block_height}   : Block height
#
# Severity Levels:
#   critical : Page immediately
#   error    : High priority
#   warning  : Medium priority (default)
#   info     : Low priority / informational
