# NEAR PagerDuty Alert Configuration
# 
# This file configures which blockchain events trigger PagerDuty alerts.
# Copy this to config.yaml and customize for your needs.

# Your PagerDuty Events API v2 integration key
# Get this from: PagerDuty → Services → Your Service → Integrations → Events API V2
pagerduty_routing_key: "YOUR_PAGERDUTY_ROUTING_KEY_HERE"

# Reconnection delay when WebSocket disconnects (seconds)
reconnect_delay_secs: 5

# Event subscriptions - each triggers PagerDuty alerts when matching events occur
subscriptions:
  # ==========================================================================
  # House of Stake Governance Monitoring
  # Monitors vote.dao for proposals and votes (same events as Tear Telegram bot)
  # ==========================================================================
  
  - name: "HoS: New Proposal Created"
    event_type: log_nep297
    severity: warning
    testnet: false
    summary_template: "House of Stake: New proposal created"
    dedup_key_template: "hos-proposal-{transaction_id}"
    filter:
      And:
        - path: account_id
          operator:
            Equals: "vote.dao"
        - path: event_standard
          operator:
            Equals: "venear"
        - path: event_event
          operator:
            Equals: "create_proposal"

  - name: "HoS: Proposal Approved for Voting"
    event_type: log_nep297
    severity: info
    testnet: false
    summary_template: "House of Stake: Proposal approved and open for voting"
    dedup_key_template: "hos-approve-{transaction_id}"
    filter:
      And:
        - path: account_id
          operator:
            Equals: "vote.dao"
        - path: event_standard
          operator:
            Equals: "venear"
        - path: event_event
          operator:
            Equals: "proposal_approve"

  - name: "HoS: Vote Cast"
    event_type: log_nep297
    severity: info
    testnet: false
    summary_template: "House of Stake: Vote cast on proposal"
    dedup_key_template: "hos-vote-{transaction_id}"
    filter:
      And:
        - path: account_id
          operator:
            Equals: "vote.dao"
        - path: event_standard
          operator:
            Equals: "venear"
        - path: event_event
          operator:
            Equals: "add_vote"

  # ==========================================================================
  # Custom Contract Monitoring Examples
  # Uncomment and customize these for your own contracts
  # ==========================================================================

  # Monitor all NEP-297 events from a specific contract
  # - name: "My Contract Events"
  #   event_type: log_nep297
  #   severity: warning
  #   testnet: false
  #   summary_template: "Event on my-contract.near: {event_event}"
  #   dedup_key_template: "my-contract-{transaction_id}"
  #   filter:
  #     And:
  #       - path: account_id
  #         operator:
  #           Equals: "my-contract.near"

  # Monitor specific event types from a contract
  # - name: "Token Minting"
  #   event_type: log_nep297
  #   severity: critical
  #   testnet: false
  #   summary_template: "Tokens minted on {account_id}"
  #   dedup_key_template: "mint-{transaction_id}"
  #   filter:
  #     And:
  #       - path: account_id
  #         operator:
  #           Equals: "token.my-project.near"
  #       - path: event_standard
  #         operator:
  #           Equals: "nep141"
  #       - path: event_event
  #         operator:
  #           Equals: "ft_mint"

  # Monitor all transactions to a contract
  # - name: "Contract Transactions"
  #   event_type: tx_transaction
  #   severity: info
  #   testnet: false
  #   summary_template: "Transaction to my-contract from {signer_id}"
  #   dedup_key_template: "tx-{transaction_id}"
  #   filter:
  #     And:
  #       - path: receiver_id
  #         operator:
  #           Equals: "my-contract.near"

  # Monitor FT transfers of a specific token
  # - name: "Large NEAR Transfers"
  #   event_type: ft_transfer
  #   severity: warning
  #   testnet: false
  #   summary_template: "FT transfer on {token_id}"
  #   dedup_key_template: "ft-{transaction_id}"
  #   filter:
  #     And:
  #       - path: token_id
  #         operator:
  #           Equals: "wrap.near"

  # Monitor NFT mints from a collection
  # - name: "NFT Minted"
  #   event_type: nft_mint
  #   severity: info
  #   testnet: false
  #   summary_template: "NFT minted in {token_id}"
  #   dedup_key_template: "nft-mint-{transaction_id}"
  #   filter:
  #     And:
  #       - path: token_id
  #         operator:
  #           EndsWith: ".my-nft-project.near"

# =============================================================================
# Available Event Types (from Intear API)
# =============================================================================
# 
# - log_nep297      : NEP-297 events (EVENT_JSON:{...}) - most common
# - log_text        : Raw text log events
# - tx_transaction  : All transactions
# - tx_receipt      : All receipts
# - ft_transfer     : Fungible token transfers
# - ft_mint         : Fungible token minting
# - ft_burn         : Fungible token burning
# - nft_mint        : NFT minting
# - nft_transfer    : NFT transfers  
# - nft_burn        : NFT burning
# - trade_swap      : DEX swaps
# - trade_pool_change : Liquidity pool changes
# - price_token     : Token price updates
# - socialdb_index  : SocialDB events
# - potlock_donation: Potlock donations

# =============================================================================
# Filter Operators
# =============================================================================
#
# Comparison:
#   Equals, NotEqual, GreaterThan, LessThan, GreaterOrEqual, LessOrEqual
#
# String:
#   StartsWith, EndsWith, Contains
#
# Array/Object:
#   ArrayContains, HasKey
#
# Logical:
#   And: [...], Or: [...]
#
# Path syntax:
#   - Use dots for nested: "data.user.name"
#   - Use brackets for arrays: "tokens[0]"
#   - Use "." for root when using And/Or

# =============================================================================
# Severity Levels (PagerDuty)
# =============================================================================
#
# - critical : Page immediately
# - error    : High priority
# - warning  : Medium priority (default)
# - info     : Low priority / informational
